<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="act_hr_timesheet_sanity_check_last_week" model="ir.actions.act_window" >
            <field name="name">上周分析</field>
            <field name="res_model">account.analytic.line</field>
            <field name="view_mode">tree</field>
            <field name="domain">[('sanity_fail_reason', 'not in', ['',False]),
                ('date',"&gt;=",(context_today() - datetime.timedelta(days=context_today().weekday() + 7)).strftime('%Y-%m-%d')),
                ('date',"&lt;=",(context_today() - datetime.timedelta(days=context_today().weekday() +1)).strftime('%Y-%m-%d')),
                '|', '|',('user_id', '=',uid),('approver.user_id', '=', uid), '|',("employee_id.approver.user_id",'=',uid),'|',("employee_id.approver.approver.user_id",'=',uid),
                '|',('employee_id.approver.approver.approver.user_id','=',uid),'|',('employee_id.approver.approver.approver.approver.user_id','=',uid),
                ('employee_id.approver.approver.approver.approver.approver.user_id','=',uid)]</field>
             <field name="context">{
                "search_default_week":1,
            }</field>
            <field name="search_view_id" ref="hr_timesheet_line_search"/>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Record a new activity
              </p><p>
                You can register and track your workings hours by project every
                day. Every time spent on a project will become a cost and can be re-invoiced to
                customers if required.
              </p>
            </field>
        </record>

        <record id="act_hr_timesheet_sanity_check_last_month" model="ir.actions.act_window" >
            <field name="name">上月分析</field>
            <field name="res_model">account.analytic.line</field>
            <field name="view_mode">tree</field>
            <field name="domain">[('sanity_fail_reason', 'not in', ['',False]),
                ('date','&lt;', time.strftime('%Y-%m-01')),('date','&gt;=',  (context_today() - relativedelta(months=1)).strftime('%Y-%m-01') ),
                '|', '|',('user_id', '=',uid),('approver.user_id', '=', uid),'|',("employee_id.approver.user_id",'=',uid), '|',("employee_id.approver.approver.user_id",'=',uid),
                '|',('employee_id.approver.approver.approver.user_id','=',uid),'|',('employee_id.approver.approver.approver.approver.user_id','=',uid),
                ('employee_id.approver.approver.approver.approver.approver.user_id','=',uid)]</field>
             <field name="context">{
                "search_default_week":1,
            }</field>
            <field name="search_view_id" ref="hr_timesheet_line_search"/>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Record a new activity
              </p><p>
                You can register and track your workings hours by project every
                day. Every time spent on a project will become a cost and can be re-invoiced to
                customers if required.
              </p>
            </field>
        </record>

         <record id="act_hr_timesheet_sanity_check_this_month" model="ir.actions.act_window" >
            <field name="name">本月分析(截止到本月最后一天)</field>
            <field name="res_model">account.analytic.line</field>
            <field name="view_mode">tree</field>
            <field name="domain">[('sanity_fail_reason', 'not in', ['',False]),
                ('date','&gt;=', time.strftime('%Y-%m-01')),('date','&lt;',  (context_today() + relativedelta(months=1)).strftime('%Y-%m-01')),
                '|', '|',('user_id', '=',uid),('approver.user_id', '=', uid), '|',("employee_id.approver.user_id",'=',uid),'|',("employee_id.approver.approver.user_id",'=',uid),
                '|',('employee_id.approver.approver.approver.user_id','=',uid),'|',('employee_id.approver.approver.approver.approver.user_id','=',uid),
                ('employee_id.approver.approver.approver.approver.approver.user_id','=',uid)]</field>
             <field name="context">{
                "search_default_week":1,
            }</field>
            <field name="search_view_id" ref="hr_timesheet_line_search"/>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Record a new activity
              </p><p>
                You can register and track your workings hours by project every
                day. Every time spent on a project will become a cost and can be re-invoiced to
                customers if required.
              </p>
            </field>
        </record>

        <record id="act_hr_timesheet_sanity_check_this_week" model="ir.actions.act_window" >
            <field name="name">本周分析（周一--周日）</field>
            <field name="res_model">account.analytic.line</field>
            <field name="view_mode">tree</field>
            <field name="domain">[('sanity_fail_reason', 'not in', ['',False]),
                ('date',">",(context_today() - datetime.timedelta(days=context_today().weekday() +1)).strftime('%Y-%m-%d')),
                ('date',"&lt;=",(context_today() - datetime.timedelta(days=context_today().weekday()) +datetime.timedelta(days=6)).strftime('%Y-%m-%d')),
                '|', '|',('user_id', '=',uid),('approver.user_id', '=', uid), '|',("employee_id.approver.user_id",'=',uid),'|',("employee_id.approver.approver.user_id",'=',uid),
                '|',('employee_id.approver.approver.approver.user_id','=',uid),'|',('employee_id.approver.approver.approver.approver.user_id','=',uid),
                ('employee_id.approver.approver.approver.approver.approver.user_id','=',uid)]</field>
             <field name="context">{
                "search_default_week":1,
            }</field>
            <field name="search_view_id" ref="hr_timesheet_line_search"/>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Record a new activity
              </p><p>
                You can register and track your workings hours by project every
                day. Every time spent on a project will become a cost and can be re-invoiced to
                customers if required.
              </p>
            </field>
        </record>

          <record id="hr_timesheet_line_sanity_check_tree" model="ir.ui.view">
                    <field name="name">et</field>
                    <field name="model">account.analytic.line</field>
                    <field name="arch" type="xml">
                        <tree editable="top" string="Timesheet Activities" import="false" create="false" default_order="sanity_fail_reason" >
                             <field name="employee_id" readonly="1" />
                                <field name="date" readonly="1" />
                                 <field name="unit_amount" widget="timesheet_uom" readonly="1"  />
                                  <field name="timesheet_type" readonly="1" />
                                <field name="project_id" readonly="1" required="1" />
                                <field name="task_id" readonly="1" context="{'default_project_id': project_id}" domain="[('project_id', '=', project_id)]" />
                                 <field name="approver" readonly="1" />
                                <field name="is_approval"  readonly="1"/>
                                <field name="sanity_fail_reason"  string="错误原因" readonly="1"/>
                        </tree>
                    </field>
                </record>



        <record model="ir.actions.act_window.view" id="act_hr_timesheet_sanity_check_tree">
            <field name="sequence" eval="3"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="hr_timesheet_line_sanity_check_tree"/>
            <field name="act_window_id" ref="act_hr_timesheet_sanity_check_last_week"/>
        </record>

        <record model="ir.actions.act_window.view" id="act_hr_timesheet_sanity_check_tree2">
            <field name="sequence" eval="3"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="hr_timesheet_line_sanity_check_tree"/>
            <field name="act_window_id" ref="act_hr_timesheet_sanity_check_last_month"/>
        </record>
           <record model="ir.actions.act_window.view" id="act_hr_timesheet_sanity_check_tree3">
            <field name="sequence" eval="3"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="hr_timesheet_line_sanity_check_tree"/>
            <field name="act_window_id" ref="act_hr_timesheet_sanity_check_this_week"/>
        </record>

        <record model="ir.actions.act_window.view" id="act_hr_timesheet_sanity_check_tree4">
            <field name="sequence" eval="3"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="hr_timesheet_line_sanity_check_tree"/>
            <field name="act_window_id" ref="act_hr_timesheet_sanity_check_this_month"/>
        </record>
        <record model="ir.actions.server" id="check_last_week">
            <field name="name">action_test</field>
             <field name="model_id" ref="analytic.model_account_analytic_line"/>
              <field name="state">code</field>
        <field name="code">
           if model.check_last_week():
                action=env.ref("hr_timesheet.act_hr_timesheet_sanity_check_last_week").read()[0]
        </field>

        </record>
        <record model="ir.actions.server" id="check_last_month">
            <field name="name">action_test</field>
             <field name="model_id" ref="analytic.model_account_analytic_line"/>
              <field name="state">code</field>
        <field name="code">
           if model.check_last_month():
                action=env.ref("hr_timesheet.act_hr_timesheet_sanity_check_last_month").read()[0]
        </field>

        </record>
         <record model="ir.actions.server" id="check_this_week">
            <field name="name">action_test</field>
             <field name="model_id" ref="analytic.model_account_analytic_line"/>
              <field name="state">code</field>
            <field name="code">
                if model.check_this_week():
                    action=env.ref("hr_timesheet.act_hr_timesheet_sanity_check_this_week").read()[0]
            </field>
         </record>
         <record model="ir.actions.server" id="check_this_month">
            <field name="name">action_test</field>
             <field name="model_id" ref="analytic.model_account_analytic_line"/>
              <field name="state">code</field>
            <field name="code">
                if model.check_this_month():
                    action=env.ref("hr_timesheet.act_hr_timesheet_sanity_check_this_month").read()[0]
                </field>
        </record>


        <menuitem id="menu_timesheets_sanity_check"
            name="Sanity_check"
            parent="timesheet_menu_root"
            groups="group_hr_timesheet_user"
            sequence="79"/>



      <menuitem id="timesheet_menu_sanity_check_timesheet_last_week"
        parent="menu_timesheets_sanity_check"
        action="check_last_week"
        name="上周分析"
        groups="group_hr_timesheet_user"
        sequence="15"/>
        <menuitem id="timesheet_menu_sanity_check_timesheet_last_month"
        parent="menu_timesheets_sanity_check"
        action="check_last_month"
        groups="group_hr_timesheet_user"
        name="上月分析"
        sequence="16"/>
         <menuitem id="timesheet_menu_sanity_check_timesheet_this_week"
        parent="menu_timesheets_sanity_check"
        action="check_this_week"
        name="本周分析"
        groups="group_hr_timesheet_user"
        sequence="17"/>
        <menuitem id="timesheet_menu_sanity_check_timesheet_this_month"
        parent="menu_timesheets_sanity_check"
        action="check_this_month"
        name="本月分析"
        groups="group_hr_timesheet_user"
        sequence="18"/>

    </data>
</odoo>
